/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{414:function(Aa,ua,y){y.r(ua);var oa=y(1),ja=y(14),ka=y(2);Aa=y(48);var ha=y(32),da=y(9);y=function(){function ca(){this.init()}ca.prototype.init=function(){this.L0=!1;this.pe=this.Zj=this.connection=null;this.Vp={};this.wa=this.gC=null};ca.prototype.ifa=function(w){for(var x=this,n=0;n<w.length;++n){var e=w[n];switch(e.at){case "create":this.Vp[e.author]||(this.Vp[e.author]=e.aName);this.T7(e);break;case "modify":this.wa.Xq(e.xfdf).then(function(a){x.wa.JH(a[0])});
break;case "delete":this.wa.Xq("<delete><id>"+e.aId+"</id></delete>")}}};ca.prototype.T7=function(w){var x=this;this.wa.Xq(w.xfdf).then(function(n){n=n[0];n.authorId=w.author;x.wa.JH(n);x.wa.trigger(ja.a.UPDATE_ANNOTATION_PERMISSION,[n])})};ca.prototype.w7=function(w,x,n){this.Zj&&this.Zj(w,x,n)};ca.prototype.preloadAnnotations=function(w){this.addEventListener("webViewerServerAnnotationsEnabled",this.w7.bind(this,w,"add",{imported:!1}),{once:!0})};ca.prototype.initiateCollaboration=function(w,x,
n){var e=this;if(w){e.pe=x;e.wa=n.Fa();n.addEventListener(ja.d.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.Ffa(w);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var b=JSON.parse(a.responseText);e.connection=exports.Ma.oga(Object(ha.h)(e.pe,"blackbox/"),"annot");e.gC=b.id;e.Vp[b.id]=b.user_name;e.wa.JT(b.id);e.connection.kma(function(f){f.t&&f.t.startsWith("a_")&&f.data&&e.ifa(f.data)},function(){e.connection.send({t:"a_retrieve",
dId:w});e.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.Vp[b.id],e.gC])},function(){e.disableCollaboration()})}catch(f){Object(ka.g)(f.message)}});a.open("GET",Object(ha.h)(this.pe,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();e.L0=!0;e.wa.Nca(function(b){return e.Vp[b.Author]||b.Author})}else Object(ka.g)("Document ID required for collaboration")};ca.prototype.disableCollaboration=function(){this.Zj&&(this.wa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Zj),this.Zj=
null);this.connection&&this.connection.Sn();this.wa&&this.wa.JT("Guest");this.init();this.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ca.prototype.Ffa=function(w){var x=this;this.Zj&&this.wa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Zj);this.Zj=function(n,e,a){return Object(oa.b)(this,void 0,void 0,function(){var b,f,h,r,z,fa,la,aa,ba;return Object(oa.d)(this,function(ia){switch(ia.label){case 0:if(a.imported)return[2];b={t:"a_"+e,dId:w,annots:[]};return[4,x.wa.f4()];case 1:f=
ia.ea();"delete"!==e&&(h=(new DOMParser).parseFromString(f,"text/xml"),r=new XMLSerializer);for(z=0;z<n.length;z++)fa=n[z],aa=la=void 0,"add"===e?(la=h.querySelector('[name="'+fa.Id+'"]'),aa=r.serializeToString(la),ba=null,fa.InReplyTo&&(ba=x.wa.sz(fa.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:fa.Id,author:x.gC,aName:x.Vp[x.gC],parent:ba,xfdf:"<add>"+aa+"</add>"})):"modify"===e?(la=h.querySelector('[name="'+fa.Id+'"]'),aa=r.serializeToString(la),b.annots.push({at:"modify",aId:fa.Id,
xfdf:"<modify>"+aa+"</modify>"})):"delete"===e&&b.annots.push({at:"delete",aId:fa.Id});0<b.annots.length&&x.connection.send(b);return[2]}})})}.bind(x);this.wa.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.Zj)};ca.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ca}();Object(Aa.a)(y);ua["default"]=y}}]);}).call(this || window)
